#include <stdio.h>

#include "vnc_proto.h"
#include "vnc.h"

#define W	10
#define H	10
#define BPP	8

unsigned char screen[W * H * BPP / 8] = {
	0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00,
	0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
	0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
	0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
	0x80, 0x00, 0x00, 0x00, 0x05, 0x05, 0x00, 0x00, 0x00, 0x80,
	0x80, 0x00, 0x00, 0x00, 0x40, 0x40, 0x00, 0x00, 0x00, 0x80,
	0x80, 0x00, 0x00, 0x00, 0x05, 0x05, 0x00, 0x00, 0x00, 0x80,
	0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
	0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
	0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00,
};

vnc_server_init_t init = {
	.port = VNC_DEFAULT_PORT,
	.screen = &screen,
	.name = "hello vnc",
	.width = W,
	.height = H,
	.fmt = {
		.bpp = BPP,
		.depth = BPP,
		.big = 0,
		.truecol = 0,
	},
};

int main( int argc, char *argv[])
{
	int arg = 1;
	
	while (arg < argc)
	{
		sscanf( argv[arg], "%d", &init.port);
		break;
	}

	void *p = vnc_init_server( &init);

	while (1)
	{
		if (vnc_sync( p) < 0)
			break;
	}

	vnc_close_server( p);

	return 0;
}
